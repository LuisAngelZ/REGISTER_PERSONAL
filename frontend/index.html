<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Personal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/personal.css">
    <link rel="stylesheet" href="/static/css/reporte.css">
    <link rel="stylesheet" href="/static/css/rol.css">
    <link rel="stylesheet" href="/static/css/darkmode.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
</head>
<body>

    <!-- ============ AUTH LOGIN SCREEN ============ -->
    <div id="authScreen" class="login-screen" style="display:none;">
        <div class="login-card">
            <div class="login-header">
                <div class="icon-circle">&#128100;</div>
                <h1 id="authTitle">Iniciar Sesion</h1>
                <p id="authSubtitle">Ingresa tus credenciales</p>
            </div>

            <div class="form-group">
                <label>Usuario</label>
                <input type="text" class="form-input" id="authUsername" placeholder="Tu usuario" onkeypress="if(event.key==='Enter')loginUsuario()">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" class="form-input" id="authPassword" placeholder="Tu password" onkeypress="if(event.key==='Enter')loginUsuario()">
            </div>

            <!-- Campos extra para registro (ocultos por defecto) -->
            <div id="authRegistroFields" style="display:none;">
                <div class="form-group">
                    <label>Nombre completo</label>
                    <input type="text" class="form-input" id="authNombre" placeholder="Tu nombre">
                </div>
            </div>

            <button class="btn btn-primary" id="btnAuth" onclick="loginUsuario()" style="margin-top:20px;">Ingresar</button>

            <div id="authStatus" class="login-status"></div>

            <div class="login-divider">o</div>

            <button class="btn btn-ghost" id="btnToggleRegistro" onclick="toggleRegistro()">Crear cuenta nueva</button>
        </div>
    </div>

    <!-- ============ DEVICE LOGIN SCREEN ============ -->
    <div id="loginScreen" class="login-screen" style="display:none;">
        <div class="login-card">
            <div class="login-header">
                <div class="icon-circle">&#128274;</div>
                <h1>Conectar Dispositivo</h1>
                <p>Conecta tu dispositivo biometrico ZKTeco</p>
                <p id="loginUserInfo" style="font-size:0.8rem;color:var(--accent);margin-top:4px;"></p>
            </div>

            <div class="form-group">
                <label>IP del Dispositivo</label>
                <input type="text" class="form-input" id="loginIp" placeholder="192.168.100.200" onkeypress="if(event.key==='Enter')intentarConexion()">
            </div>
            <div class="form-group">
                <label>Puerto</label>
                <input type="number" class="form-input" id="loginPuerto" value="4370" min="1" max="65535" onkeypress="if(event.key==='Enter')intentarConexion()">
            </div>
            <div class="form-group">
                <label>Clave de Comunicacion</label>
                <input type="number" class="form-input" id="loginPassword" value="0" onkeypress="if(event.key==='Enter')intentarConexion()">
            </div>

            <button class="btn btn-primary" id="btnConectar" onclick="intentarConexion()" style="margin-top:20px;">Conectar</button>

            <div class="login-divider">o</div>

            <button class="btn btn-ghost" onclick="entrarSinDispositivo()">Entrar sin dispositivo</button>

            <div id="loginStatus" class="login-status"></div>
        </div>
    </div>

    <!-- ============ MAIN APP ============ -->
    <div id="mainApp" class="main-app">

        <!-- Navbar -->
        <nav class="navbar">
            <div class="navbar-brand">
                &#9881; Registro de Personal <span>| ZKTeco</span>
            </div>
            <div style="display:flex;align-items:center;gap:12px;">
                <div id="devicePill" class="device-pill connecting">
                    <span class="pill-dot yellow"></span>
                    <span class="pill-text" id="devicePillText">Conectando...</span>
                </div>
                <span id="navUserInfo" style="font-size:0.75rem;color:var(--slate-400);"></span>
                <button class="dark-toggle" onclick="toggleDarkMode()" title="Modo oscuro">&#9790;</button>
                <button class="btn btn-sm btn-ghost" id="btnLogout" onclick="cerrarSesion()" style="display:none;font-size:0.75rem;padding:4px 10px;">Salir</button>
            </div>
        </nav>

        <!-- Section Navigation -->
        <div class="section-nav">
            <button class="nav-item active" onclick="switchSection('personal', this)">Personal</button>
            <button class="nav-item" onclick="switchSection('dashboard', this); cargarDashboard();">Dashboard</button>
            <button class="nav-item" onclick="switchSection('registrar', this)">Registrar</button>
            <button class="nav-item" onclick="switchSection('editar-section', this)">Editar</button>
            <button class="nav-item" onclick="switchSection('reporte', this); cargarReporteInit();">Reporte</button>
            <button class="nav-item" onclick="switchSection('configuracion', this); if(usuarioActual) document.getElementById('cpUsername').value=usuarioActual.username;">Configuracion</button>
            <button class="nav-item" onclick="switchSection('rol-libres', this); generarRolLibres();">Rol de Libres</button>
        </div>

        <!-- Alert container -->
        <div id="alerts" class="alert-container"></div>

        <!-- Content -->
        <div class="content">
            <!-- Skeleton en personal (seccion activa al cargar) -->
            <div id="personal" class="section active">
                <div class="sk-grid3">
                    <div class="skeleton sk-h80"></div>
                    <div class="skeleton sk-h80"></div>
                    <div class="skeleton sk-h80"></div>
                </div>
                <div class="skeleton sk-h44" style="margin-bottom:20px;"></div>
                <div class="sk-cards">
                    <div class="skeleton sk-h140"></div>
                    <div class="skeleton sk-h140"></div>
                    <div class="skeleton sk-h140"></div>
                    <div class="skeleton sk-h140"></div>
                    <div class="skeleton sk-h140"></div>
                    <div class="skeleton sk-h140"></div>
                </div>
            </div>
            <!-- Skeleton simple para las demas secciones -->
            <div id="dashboard"      class="section"><div class="skeleton sk-h300"></div></div>
            <div id="registrar"      class="section"><div class="skeleton sk-h300"></div></div>
            <div id="editar-section" class="section"><div class="skeleton sk-h300"></div></div>
            <div id="reporte"        class="section"><div class="skeleton sk-h300"></div></div>
            <div id="configuracion"  class="section"><div class="skeleton sk-h300"></div></div>
            <div id="rol-libres"     class="section"><div class="skeleton sk-h300"></div></div>
        </div>
    </div>

    <script src="/static/js/helpers.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/device.js"></script>
    <script src="/static/js/personal.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/reporte.js"></script>
    <script src="/static/js/rol.js"></script>
    <script src="/static/js/app.js"></script>

    <!-- ====== MODAL: Vista Previa Rol de Libres ====== -->
    <div id="rolPreviewModal" class="modal-overlay" style="display:none;align-items:flex-start;padding-top:20px;" onclick="if(event.target===this)cerrarPreviewRol()">
        <div class="modal-content" style="width:98vw;max-width:1200px;max-height:92vh;display:flex;flex-direction:column;padding:0;overflow:hidden;">
            <!-- Header controles -->
            <div class="modal-header" style="padding:10px 16px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;flex-shrink:0;">
                <h3 style="margin:0;">Vista Previa &mdash; Rol de Dias Libres</h3>
                <div style="display:flex;gap:14px;align-items:center;flex-wrap:wrap;">
                    <label style="display:flex;align-items:center;gap:6px;font-size:0.82rem;white-space:nowrap;">
                        Alto de filas:
                        <input type="range" id="rolRowHeight" min="28" max="160" value="120"
                               oninput="ajustarAltoFila(this.value)" style="width:100px;">
                        <span id="rolRowHeightVal" style="min-width:28px;">120</span>px
                    </label>
                    <label style="display:flex;align-items:center;gap:6px;font-size:0.82rem;white-space:nowrap;">
                        Fuente:
                        <input type="range" id="rolFontSize" min="6" max="16" value="11"
                               oninput="ajustarFuenteRol(this.value)" style="width:80px;">
                        <span id="rolFontSizeVal" style="min-width:20px;">11</span>pt
                    </label>
                    <button class="btn btn-sm btn-primary" onclick="imprimirRol()">Imprimir</button>
                    <button class="btn btn-sm btn-ghost" onclick="cerrarPreviewRol()">Cerrar</button>
                </div>
            </div>
            <!-- Cuerpo de la vista previa (fondo gris = simula escritorio) -->
            <div id="rolPreviewBody" style="background:#9e9e9e;padding:16px;overflow:auto;flex:1;"></div>
        </div>
    </div>
</body>
</html>
